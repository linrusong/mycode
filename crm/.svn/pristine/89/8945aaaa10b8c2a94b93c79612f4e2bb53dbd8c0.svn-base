<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <!--配置Mybatis的session工厂-->
    <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
        <property name="dataSource" ref="dataSource" />
        <property name="mapperLocations" value="classpath*:/mapper/*.xml"/>
    </bean>

    <!--配置Mybatis自动扫描所有的映射类（mapper）dao，省去为每个dao单独配置-->
    <bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">
        <property name="basePackage" value="com.wasu.ptyw.crm.dao"/>
        <property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"></property>
    </bean>

    <!-- 事务管理 -->
    <bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource">
            <ref local="dataSource" />
        </property>
    </bean>

    <!-- 事务模板 -->
    <bean id="transactionTemplate" class="org.springframework.transaction.support.TransactionTemplate">
        <property name="transactionManager">
            <ref local="transactionManager" />
        </property>
    </bean>

    <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource"
          destroy-method="close">
        <property name="driverClassName" value="com.mysql.jdbc.Driver" />
        <property name="url" value="jdbc:mysql://127.0.0.1:3306/crm?useUnicode=true&amp;characterEncoding=UTF-8" />
        <property name="username" value="root" />
        <property name="password" value="123456" />

        <!-- 最大活动连接数 -->
        <property name="maxActive" value="20" />
        <!-- 最大可空闲连接数 -->
        <property name="maxIdle" value="20" />
        <!-- 最小可空闲连接数 -->
        <property name="minIdle" value="5" />
        <!-- 最大可等待连接数 -->
        <property name="maxWait" value="500" />
        <!-- 默认的提交方式（如果不需要事务可以设置成true，在实际应用中一般设置为false,默认为false） -->
        <property name="defaultAutoCommit" value="true" />
        <!-- 自动回收 2012-06-18 by 叶大金 -->
        <property name="removeAbandoned" value="true" />
        <!--异步Evict的TimerTask定时线程进行控制  -->
        <property name= "testWhileIdle" value= "true" />
        <!--就是在进行borrowObject进行处理时，对拿到的connection进行validateObject校验-->
        <property name= "testOnBorrow" value= "true" />
        <!--就是在进行returnObject对返回的connection进行validateObject校验，-->
        <property name= "testOnReturn" value= "false" />
        <!-- 代表检查的sql-->
        <property name= "validationQuery" value = "select 1 " />
        <!-- 代表在执行检查时，通过statement设置-->
        <property name= "validationQueryTimeout" value="1" />
        <!-- 设置的Evict线程的时间，单位ms，大于0才会开启evict检查线程-->
        <property name="timeBetweenEvictionRunsMillis"><value>30000</value></property>
        <!-- 连接池中连接可空闲的时间 5个小时-->
        <property name="minEvictableIdleTimeMillis"><value>18000000</value></property>
        <!--代表每次检查链接的数量，建议设置和maxActive一样大，这样每次可以有效检查所有的链接-->
        <property name="numTestsPerEvictionRun"><value>20</value></property>

    </bean>

</beans>